<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administrador - AbueClick</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style/style.css">
  <link rel="stylesheet" href="style/styleadmin.css">
  <style>
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body>
  <div class="sitio">
    <header id="barra-navegacion">
      <div class="nav-izquierda">
        <div class="marca">
          <img src="resources/img/Imagotipo.png" alt="AbueClick" class="logo-navegacion">
        </div>
        <nav>
          <ul class="menu-navegacion">
            <li><a href="admin.html">Panel Admin</a></li>
            <li><a href="index.html">Ver Sitio</a></li>
          </ul>
        </nav>
      </div>
      <div class="nav-derecha">
        <a href="perfil.html" class="boton-perfil" aria-label="Perfil" title="Perfil">
          <span class="circulo-avatar" id="avatarUsuario">AD</span>
        </a>
        <button onclick="cerrarSesion()" class="btn-logout">Cerrar Sesi칩n</button>
      </div>
    </header>

    <main class="admin-main">
      <div class="admin-container">
        <div class="admin-header">
          <h1>丘뙖잺 Panel de Administrador</h1>
          <p class="admin-subtitle">Gesti칩n y estad칤sticas de AbueClick</p>
        </div>

        <!-- Estad칤sticas -->
        <div class="admin-stats">
          <div class="stat-card">
            <div class="stat-icon">游논</div>
            <div class="stat-info">
              <h3 id="totalUsuarios">0</h3>
              <p>Usuarios Totales</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">游놊</div>
            <div class="stat-info">
              <h3 id="totalAdultosMayores">0</h3>
              <p>Adultos Mayores</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">游뱋</div>
            <div class="stat-info">
              <h3 id="totalAcompanantes">0</h3>
              <p>Acompa침antes</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">游늰</div>
            <div class="stat-info">
              <h3 id="totalCitas">0</h3>
              <p>Citas Agendadas</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">游눫</div>
            <div class="stat-info">
              <h3 id="totalConversaciones">0</h3>
              <p>Conversaciones</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">游댒</div>
            <div class="stat-info">
              <h3 id="totalNotificaciones">0</h3>
              <p>Notificaciones</p>
            </div>
          </div>
        </div>

        <!-- Tabs de gesti칩n -->
        <div class="admin-tabs">
          <button class="tab-btn active" onclick="mostrarTab('usuarios')">游논 Usuarios</button>
          <button class="tab-btn" onclick="mostrarTab('citas')">游늰 Citas</button>
          <button class="tab-btn" onclick="mostrarTab('conversaciones')">游눫 Conversaciones</button>
          <button class="tab-btn" onclick="mostrarTab('notificaciones')">游댒 Notificaciones</button>
        </div>

        <!-- Contenido de tabs -->
        <div class="admin-content">
          <!-- Tab Usuarios -->
          <div id="tab-usuarios" class="tab-content active">
            <div class="admin-section-header">
              <h2>Gesti칩n de Usuarios</h2>
              <div class="admin-filters">
                <select id="filtroTipoUsuario" onchange="filtrarUsuarios()">
                  <option value="todos">Todos los usuarios</option>
                  <option value="adultoMayor">Adultos Mayores</option>
                  <option value="acompanante">Acompa침antes</option>
                </select>
              </div>
            </div>
            <div id="usuariosList" class="admin-list">
              <!-- Se cargar치 din치micamente -->
            </div>
          </div>

          <!-- Tab Citas -->
          <div id="tab-citas" class="tab-content">
            <div class="admin-section-header">
              <h2>Gesti칩n de Citas</h2>
            </div>
            <div id="citasList" class="admin-list">
              <!-- Se cargar치 din치micamente -->
            </div>
          </div>

          <!-- Tab Conversaciones -->
          <div id="tab-conversaciones" class="tab-content">
            <div class="admin-section-header">
              <h2>Conversaciones Activas</h2>
            </div>
            <div id="conversacionesList" class="admin-list">
              <!-- Se cargar치 din치micamente -->
            </div>
          </div>

          <!-- Tab Notificaciones -->
          <div id="tab-notificaciones" class="tab-content">
            <div class="admin-section-header">
              <h2>Todas las Notificaciones</h2>
            </div>
            <div id="notificacionesList" class="admin-list">
              <!-- Se cargar치 din치micamente -->
            </div>
          </div>

          <!-- Tab Base de Datos -->
          <div id="tab-database" class="tab-content">
            <div class="admin-section-header">
              <h2>Gesti칩n de Base de Datos Compartida</h2>
            </div>
            <div class="database-management">
              <div class="database-info">
                <h3>游늶 Informaci칩n de Sincronizaci칩n</h3>
                <p><strong>칔ltima actualizaci칩n:</strong> <span id="ultimaActualizacionDB">Cargando...</span></p>
                <p><strong>Estado:</strong> <span id="estadoSincronizacion">Verificando...</span></p>
              </div>
              
              <div class="database-actions">
                <h3>游댢 Acciones</h3>
                <div class="action-buttons">
                  <button class="btn-admin-primary" onclick="sincronizarManual()">
                    游댃 Sincronizar Ahora
                  </button>
                  <button class="btn-admin-primary" onclick="descargarBaseDatos()">
                    拘勇 Exportar Base de Datos
                  </button>
                  <label class="btn-admin-primary" style="cursor: pointer;">
                    拘勇 Importar Base de Datos
                    <input type="file" accept=".json" style="display: none;" onchange="manejarImportarDB(event)">
                  </label>
                </div>
              </div>

              <div class="database-instructions">
                <h3>游닀 Instrucciones para Compartir</h3>
                <ol>
                  <li><strong>Exportar:</strong> Haz clic en "Exportar Base de Datos" para descargar el archivo database.json</li>
                  <li><strong>Compartir:</strong> Comparte el archivo database.json con otros usuarios (Dropbox, Google Drive, carpeta compartida, etc.)</li>
                  <li><strong>Importar:</strong> Los otros usuarios deben usar "Importar Base de Datos" y seleccionar el archivo compartido</li>
                  <li><strong>Sincronizar:</strong> La sincronizaci칩n autom치tica ocurre cada 30 segundos cuando el archivo database.json est치 disponible</li>
                </ol>
                <p><strong>Nota:</strong> Coloca el archivo database.json en la ra칤z del proyecto para que la sincronizaci칩n autom치tica funcione.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer id="pie-pagina">
      <div class="contenedor-pie-pagina">
        <div class="columna-pie-pagina">
          <h3 class="titulo-pie-pagina">ABUECLICK</h3>
          <h4 class="subtitulo-pie-pagina">CONT츼CTANOS</h4>
          <div class="item-contacto-pie-pagina">
            <span class="icono-pie-pagina">游</span>
            <div>
              <p class="etiqueta-pie-pagina">L칤nea de servicio</p>
              <p class="valor-pie-pagina">+57 314 6904576</p>
            </div>
          </div>
          <div class="item-contacto-pie-pagina">
            <span class="icono-pie-pagina">游닎</span>
            <div>
              <p class="etiqueta-pie-pagina">Correo electr칩nico</p>
              <p class="valor-pie-pagina">AbueClick@gmail.com</p>
            </div>
          </div>
          <div class="item-contacto-pie-pagina">
            <span class="icono-pie-pagina">游눫</span>
            <div>
              <p class="etiqueta-pie-pagina">WhatsApp</p>
              <p class="valor-pie-pagina">+57 314 6904576</p>
            </div>
          </div>
        </div>

        <div class="columna-pie-pagina">
          <h3 class="titulo-pie-pagina">INFORMACI칍N</h3>
          <h4 class="subtitulo-pie-pagina">POL칈TICAS</h4>
          <ul class="enlaces-pie-pagina">
            <li><a href="#">Pol칤tica de privacidad</a></li>
            <li><a href="#">T칠rminos y condiciones</a></li>
            <li><a href="#">Pol칤tica de cookies</a></li>
          </ul>
          <h4 class="subtitulo-pie-pagina" style="margin-top: 20px;">ENLACES</h4>
          <ul class="enlaces-pie-pagina">
            <li><a href="index.html">Inicio</a></li>
            <li><a href="sobre-nosotros.html">Sobre nosotros</a></li>
            <li><a href="login.html">Iniciar sesi칩n</a></li>
            <li><a href="registro.html">Registrarse</a></li>
          </ul>
        </div>

        <div class="columna-pie-pagina">
          <h3 class="titulo-pie-pagina">REDES SOCIALES</h3>
          <div class="redes-pie-pagina">
            <a href="#" class="enlace-red-social">Facebook</a>
            <a href="#" class="enlace-red-social">Instagram</a>
            <a href="#" class="enlace-red-social">Twitter</a>
            <a href="#" class="enlace-red-social">LinkedIn</a>
          </div>
          <div class="actualizacion-pie-pagina">
            <p class="etiqueta-pie-pagina">Fecha 칰ltima actualizaci칩n</p>
            <p class="valor-pie-pagina">2025</p>
          </div>
        </div>
      </div>
      <div class="fondo-pie-pagina">
        <p>춸 2025 AbueClick. Todos los derechos reservados.</p>
      </div>
    </footer>
  </div>

  <script src="js/database.js"></script>
  <script src="js/autenticacion.js"></script>
  <script src="js/admin.js"></script>
  <script>
    // Verificar que el usuario sea administrador
    document.addEventListener('DOMContentLoaded', function() {
      const usuarioActual = verificarSesion();
      
      if (!usuarioActual) {
        window.location.href = 'login.html';
        return;
      }
      
      if (!usuarioActual.esAdministrador) {
        alert('Acceso denegado. Solo administradores pueden acceder a esta p치gina.');
        window.location.href = 'index.html';
        return;
      }
      
      actualizarAvatarGlobal();
      cargarEstadisticas();
      cargarUsuarios();
    });

    function cerrarSesion() {
      if (confirm('쮼st치s seguro de que deseas cerrar sesi칩n?')) {
        localStorage.removeItem('usuarioActual');
        window.location.href = 'login.html';
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</body>
</html>

